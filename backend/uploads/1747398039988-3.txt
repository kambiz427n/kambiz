//@version=5
strategy("ğŸš€ Ø§Ø³ØªØ±Ø§ØªÚ˜ÛŒ Ø³Ø§Ø¯Ù‡â€ŒØ´Ø¯Ù‡ (1h / 15m / 5m)", overlay=true, default_qty_type=strategy.percent_of_equity, default_qty_value=10)

// ÙÙ‚Ø· ØªØ§ÛŒÙ…â€ŒÙØ±ÛŒÙ…â€ŒÙ‡Ø§ÛŒ Ù…Ø´Ø®Øµâ€ŒØ´Ø¯Ù‡ Ù…Ø¬Ø§Ø² Ø¨Ø§Ø´Ù†
isValidTimeframe = (timeframe.period == "60" or timeframe.period == "15" or timeframe.period == "5")
if not isValidTimeframe
    runtime.error("â›” Ø§ÛŒÙ† Ø§Ø³ØªØ±Ø§ØªÚ˜ÛŒ ÙÙ‚Ø· Ø±ÙˆÛŒ ØªØ§ÛŒÙ…â€ŒÙØ±ÛŒÙ…â€ŒÙ‡Ø§ÛŒ 1hØŒ 15m ÛŒØ§ 5m Ú©Ø§Ø± Ù…ÛŒâ€ŒÚ©Ù†Ø¯")

// === ÙˆØ±ÙˆØ¯ÛŒâ€ŒÙ‡Ø§ === //
rsiPeriod = input.int(14, title="RSI Period")
rsiOverbought = input.int(70, title="RSI Overbought Level", minval=50, maxval=100)
rsiOversold = input.int(30, title="RSI Oversold Level", minval=0, maxval=50)
macdFast = input.int(12, title="MACD Fast")
macdSlow = input.int(26, title="MACD Slow")
macdSignal = input.int(9, title="MACD Signal")
emaFastLen = input.int(5, title="EMA Fast")
emaSlowLen = input.int(13, title="EMA Slow")
cciPeriod = input.int(20, title="CCI Period")
cciOverbought = input.int(150, title="CCI Overbought Level", minval=100, maxval=300)
cciOversold = input.int(-100, title="CCI Oversold Level", minval=-300, maxval=0)
supertrendFactor = input.float(3.0, title="Supertrend Multiplier")
supertrendATR = input.int(10, title="Supertrend ATR Length")
atrLength = input.int(14, title="ATR Length")
atrMultiplierTP = input.float(3.0, title="ATR TP Multiplier")
atrMultiplierSL = input.float(1.0, title="ATR SL Multiplier")
useDynamicLevels = input.bool(true, title="Use Dynamic TP/SL Levels")
lookback = input.int(10, title="Lookback for Dynamic Levels")
minScore = input.int(1, title="Minimum Score for Signal", minval=1, maxval=5)

// === Ø§Ù†Ø¯ÛŒÚ©Ø§ØªÙˆØ±Ù‡Ø§ === //
rsi = ta.rsi(close, rsiPeriod)
[macdLine, signalLine, _] = ta.macd(close, macdFast, macdSlow, macdSignal)
emaFast = ta.ema(close, emaFastLen)
emaSlow = ta.ema(close, emaSlowLen)
cci = ta.cci(close, cciPeriod)
[supertrend, trendDir] = ta.supertrend(supertrendFactor, supertrendATR)
atr = ta.atr(atrLength)
highestHigh = ta.highest(high, lookback)
lowestLow = ta.lowest(low, lookback)

// === ÙˆØ±ÙˆØ¯ Ø®Ø±ÛŒØ¯ === //
buyScore = 0
buyScore += rsi < rsiOversold ? 1 : 0
buyScore += ta.crossover(macdLine, signalLine) ? 1 : 0
buyScore += ta.crossover(emaFast, emaSlow) ? 1 : 0
buyScore += cci < cciOversold ? 1 : 0
buyScore += trendDir == 1 ? 1 : 0

var float lastBuyPrice = na
var float lastSellPrice = na
buyAllowed = na(lastBuyPrice) or close < lastBuyPrice * 0.995
buySignal = buyScore >= minScore and buyScore[1] < minScore and buyAllowed

// === ÙˆØ±ÙˆØ¯ ÙØ±ÙˆØ´ === //
sellScore = 0
sellScore += rsi > rsiOverbought ? 1 : 0
sellScore += ta.crossunder(macdLine, signalLine) ? 1 : 0
sellScore += ta.crossunder(emaFast, emaSlow) ? 1 : 0
sellScore += cci > cciOverbought ? 1 : 0
sellScore += trendDir == -1 ? 1 : 0

sellAllowed = na(lastSellPrice) or close > lastSellPrice * 1.005
sellSignal = sellScore >= minScore and sellScore[1] < minScore and sellAllowed

// === ÙˆØ±ÙˆØ¯ Ùˆ Ø®Ø±ÙˆØ¬ Ø¨Ø§ TP/SL === //
var float longTP = na
var float longSL = na
var float shortTP = na
var float shortSL = na

if buySignal
    longTP := useDynamicLevels ? highestHigh : close + atr * atrMultiplierTP
    longSL := useDynamicLevels ? lowestLow : close - atr * atrMultiplierSL
    lastBuyPrice := close
    lastSellPrice := na
    strategy.entry("ğŸŸ¢ Ø®Ø±ÛŒØ¯", strategy.long)
    strategy.exit("ğŸ“¤ TP/SL Buy", from_entry="ğŸŸ¢ Ø®Ø±ÛŒØ¯", limit=longTP, stop=longSL)

if sellSignal
    shortTP := useDynamicLevels ? lowestLow : close - atr * atrMultiplierTP
    shortSL := useDynamicLevels ? highestHigh : close + atr * atrMultiplierSL
    lastSellPrice := close
    lastBuyPrice := na
    strategy.entry("ğŸ”´ ÙØ±ÙˆØ´", strategy.short)
    strategy.exit("ğŸ“¤ TP/SL Sell", from_entry="ğŸ”´ ÙØ±ÙˆØ´", limit=shortTP, stop=shortSL)

// === Ø¢Ù„Ø§Ø±Ù…â€ŒÙ‡Ø§ === //
alertcondition(buySignal, title="ğŸ“ˆ Ø³ÛŒÚ¯Ù†Ø§Ù„ Ø®Ø±ÛŒØ¯", message="ğŸ“ˆ ÙˆØ±ÙˆØ¯ Ø®Ø±ÛŒØ¯ Ø¯Ø± {{ticker}} - Ù‚ÛŒÙ…Øª: {{close}}")
alertcondition(sellSignal, title="ğŸ“‰ Ø³ÛŒÚ¯Ù†Ø§Ù„ ÙØ±ÙˆØ´", message="ğŸ“‰ ÙˆØ±ÙˆØ¯ ÙØ±ÙˆØ´ Ø¯Ø± {{ticker}} - Ù‚ÛŒÙ…Øª: {{close}}")

// === Ù†Ù…Ø§ÛŒØ´ ØªØµÙˆÛŒØ±ÛŒ Ù†Ù‚Ø§Ø· ÙˆØ±ÙˆØ¯ === //
plotshape(buySignal, title="ÙˆØ±ÙˆØ¯ Ø®Ø±ÛŒØ¯", location=location.belowbar, color=color.lime, style=shape.triangleup, size=size.large, text="Buy")
plotshape(sellSignal, title="ÙˆØ±ÙˆØ¯ ÙØ±ÙˆØ´", location=location.abovebar, color=color.red, style=shape.triangledown, size=size.large, text="Sell")

// === Ù†Ù…Ø§ÛŒØ´ Ø®Ø·ÙˆØ· TP Ùˆ SL === //
plot(strategy.position_size > 0 ? longTP : na, title="ğŸ¯ TP Buy", color=color.green, style=plot.style_linebr, linewidth=1)
plot(strategy.position_size > 0 ? longSL : na, title="ğŸ›‘ SL Buy", color=color.red, style=plot.style_linebr, linewidth=1)
plot(strategy.position_size < 0 ? shortTP : na, title="ğŸ¯ TP Sell", color=color.green, style=plot.style_linebr, linewidth=1)
plot(strategy.position_size < 0 ? shortSL : na, title="ğŸ›‘ SL Sell", color=color.red, style=plot.style_linebr, linewidth=1)

// === Ø®Ø·ÙˆØ· EMA Ùˆ Supertrend Ø¨Ø±Ø§ÛŒ Ø²Ù…ÛŒÙ†Ù‡ Ø¯ÛŒØ¯ Ø¨ÛŒØ´ØªØ± === //
plot(emaFast, title="EMA Fast", color=color.orange)
plot(emaSlow, title="EMA Slow", color=color.blue)
plot(supertrend, title="Supertrend", color=trendDir == 1 ? color.green : color.red, linewidth=2)